# 监控配置域
# 包含日志、指标、追踪、告警等监控配置

# 日志配置
logging:
  # 全局日志配置
  global:
    level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    date_format: "%Y-%m-%d %H:%M:%S"
    timezone: "UTC"
  
  # 控制台输出
  console:
    enabled: true
    level: "INFO"
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    colors: true
  
  # 文件输出
  file:
    enabled: true
    level: "INFO"
    path: "logs/campusworld.log"
    max_size: "10MB"
    backup_count: 5
    rotation: "daily"  # daily, weekly, monthly
    compression: true
  
  # 结构化日志
  structured:
    enabled: true
    format: "json"
    include_timestamp: true
    include_level: true
    include_logger: true
  
  # 日志分类
  categories:
    # 应用日志
    app:
      level: "INFO"
      file: "logs/app.log"
      max_size: "10MB"
      backup_count: 3
    
    # 数据库日志
    database:
      level: "INFO"
      file: "logs/database.log"
      max_size: "10MB"
      backup_count: 3
    
    # API日志
    api:
      level: "INFO"
      file: "logs/api.log"
      max_size: "10MB"
      backup_count: 3
    
    # 安全日志
    security:
      level: "WARNING"
      file: "logs/security.log"
      max_size: "10MB"
      backup_count: 7
    
    # SSH日志
    ssh:
      level: "INFO"
      file: "logs/ssh.log"
      max_size: "10MB"
      backup_count: 5

# 指标监控
metrics:
  # 启用状态
  enabled: false  # 暂时禁用，等待实现
  
  # 指标收集
  collection:
    interval: 60  # 1 minute
    batch_size: 1000
    enable_histograms: false
    enable_summaries: false
  
  # 指标存储
  storage:
    type: "memory"  # memory, prometheus, influxdb
    retention_days: 7
    aggregation: false
  
  # 自定义指标
  custom:
    # 应用指标
    app:
      request_count: false
      response_time: false
      error_rate: false
      active_users: false
    
    # 系统指标
    system:
      cpu_usage: false
      memory_usage: false
      disk_usage: false
      network_io: false
    
    # 业务指标
    business:
      user_registrations: false
      campus_creations: false
      world_activities: false
      ssh_sessions: false

# 分布式追踪
tracing:
  # 启用状态
  enabled: false
  
  # 追踪系统
  provider: "jaeger"  # jaeger, zipkin, opentelemetry
  
  # 采样配置
  sampling:
    rate: 0.1  # 10% 采样率
    max_traces_per_second: 100
  
  # 追踪配置
  config:
    service_name: "campusworld-backend"
    environment: "development"
    version: "0.1.0"
  
  # 集成配置
  integration:
    fastapi: true
    sqlalchemy: true
    redis: true
    http: true

# 健康检查
health_check:
  # 启用状态
  enabled: true
  
  # 检查间隔
  interval: 30  # 30 seconds
  
  # 超时设置
  timeout: 5  # 5 seconds
  
  # 检查项目
  checks:
    # 数据库健康检查
    database:
      enabled: true
      timeout: 3
      critical: true
    
    # Redis健康检查
    redis:
      enabled: true
      timeout: 3
      critical: false
    
    # 外部服务健康检查
    external:
      enabled: false
      timeout: 5
      critical: false
  
  # 健康检查端点
  endpoint: "/health"
  detailed_endpoint: "/health/detailed"

# 告警系统
alerts:
  # 启用状态
  enabled: false  # 暂时禁用，等待实现
  
  # 告警规则
  rules:
    # 系统告警
    system:
      cpu_usage:
        threshold: 80
        duration: 300  # 5 minutes
        severity: "warning"
      
      memory_usage:
        threshold: 85
        duration: 300
        severity: "warning"
      
      disk_usage:
        threshold: 90
        duration: 300
        severity: "critical"
    
    # 应用告警
    application:
      error_rate:
        threshold: 0.05  # 5%
        duration: 300
        severity: "warning"
      
      response_time:
        threshold: 2000  # 2 seconds
        duration: 300
        severity: "warning"
    
    # 业务告警
    business:
      failed_logins:
        threshold: 10
        duration: 300
        severity: "warning"
      
      ssh_connections:
        threshold: 80
        duration: 300
        severity: "warning"
  
  # 通知渠道
  notifications:
    email:
      enabled: false
      smtp_server: ""
      smtp_port: 587
      username: ""
      password: ""
      recipients: []
    
    slack:
      enabled: false
      webhook_url: ""
      channel: "#alerts"
    
    webhook:
      enabled: false
      url: ""
      method: "POST"
      headers: {}

# 性能分析
profiling:
  # 启用状态
  enabled: false  # 暂时禁用，等待实现
  
  # 分析类型
  types:
    cpu: false
    memory: false
    function: false
    line: false
  
  # 采样配置
  sampling:
    cpu_interval: 0.001  # 1ms
    memory_interval: 0.1  # 100ms
  
  # 输出格式
  output:
    format: "text"  # text, json, callgrind
    file: "profiles/profile.prof"
    max_size: "100MB"

# 审计日志
audit:
  # 启用状态
  enabled: true
  
  # 审计事件
  events:
    # 用户操作
    user:
      login: true
      logout: true
      password_change: true
      profile_update: true
    
    # 权限操作
    permission:
      role_assignment: true
      permission_grant: true
      permission_revoke: true
    
    # 数据操作
    data:
      create: true
      update: true
      delete: true
      access: true
    
    # 系统操作
    system:
      configuration_change: true
      service_restart: true
      backup_operation: true
  
  # 审计存储
  storage:
    type: "file"  # file, database
    path: "logs/audit.log"
    retention_days: 365
    compression: true
  
  # 审计格式
  format:
    include_user: true
    include_ip: true
    include_timestamp: true
    include_details: true
