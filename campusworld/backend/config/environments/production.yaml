# 生产环境配置
# 继承自基础配置，覆盖生产环境特定设置

# 环境标识
environment: "production"

# 应用配置覆盖
app:
  debug: false
  environment: "production"
  features:
    ssh_console: true
    graph_database: true
    real_time_updates: true
    api_rate_limiting: true
    caching: true
    monitoring: true

# 服务器配置覆盖
server:
  reload: false
  workers: 4  # 生产环境多进程
  access_log: true
  error_log: true
  worker_class: "uvicorn.workers.UvicornWorker"
  worker_connections: 2000
  max_requests: 10000
  max_requests_jitter: 1000

# 数据库配置覆盖
postgresql:
  host: "${DB_HOST}"  # 环境变量
  port: "${DB_PORT}"
  name: "${DB_NAME}"
  user: "${DB_USER}"
  password: "${DB_PASSWORD}"
  pool:
    size: 50
    max_overflow: 100
    echo: false
  security:
    ssl_mode: "require"

# Redis配置覆盖
redis:
  host: "${REDIS_HOST}"
  port: "${REDIS_PORT}"
  password: "${REDIS_PASSWORD}"
  pool:
    max_connections: 50
    min_connections: 10

# 日志配置覆盖
logging:
  global:
    level: "WARNING"
  console:
    enabled: false
  file:
    enabled: true
    level: "WARNING"
    max_size: "100MB"
    backup_count: 10

# 监控配置覆盖
monitoring:
  metrics:
    enabled: true
    collection:
      interval: 30
  tracing:
    enabled: true
    sampling:
      rate: 0.01  # 生产环境1%采样率
  health_check:
    enabled: true
    interval: 15

# 安全配置覆盖
security:
  authentication:
    jwt:
      secret_key: "${JWT_SECRET_KEY}"
  security_policy:
    api_security:
      rate_limiting: true
      request_size_limit: "10MB"
    audit:
      enabled: true
      retention_days: 730  # 2年

# SSH配置覆盖
ssh:
  logging:
    level: "WARNING"
    file:
      path: "logs/ssh_prod.log"
      max_size: "100MB"
      backup_count: 10
  monitoring:
    performance:
      enabled: true
    alerts:
      enabled: true

# 缓存配置覆盖
cache:
  default:
    ttl: 1800  # 30分钟
    max_size: 10000
  session:
    ttl: 3600  # 1小时
    max_size: 50000

# 性能优化配置
performance:
  # 数据库优化
  database:
    connection_pooling: true
    query_cache: true
    prepared_statements: true
  
  # 应用优化
  application:
    response_cache: true
    compression: true
    async_processing: true
  
  # 缓存策略
  caching:
    redis_cluster: true
    local_cache: true
    cache_warming: true

# 高可用配置
high_availability:
  # 负载均衡
  load_balancer:
    enabled: true
    health_check_path: "/health"
    sticky_sessions: false
  
  # 故障转移
  failover:
    enabled: true
    auto_restart: true
    health_check_interval: 10
  
  # 备份策略
  backup:
    database:
      enabled: true
      schedule: "0 1 * * *"  # 每天凌晨1点
      retention_days: 30
    logs:
      enabled: true
      schedule: "0 2 * * *"  # 每天凌晨2点
      retention_days: 90

# 扩展配置
scaling:
  # 水平扩展
  horizontal:
    enabled: true
    min_instances: 2
    max_instances: 10
    auto_scaling: true
  
  # 垂直扩展
  vertical:
    enabled: false
    resource_limits:
      cpu: "4"
      memory: "8Gi"
